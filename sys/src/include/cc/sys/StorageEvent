/*
 * Copyright (C) 2018 Frank Mertens.
 *
 * Distribution and use is allowed under the terms of the zlib license
 * (see cc/LICENSE-zlib).
 *
 */

#pragma once

#include <cc/string>

struct udev_device;

namespace cc {
namespace sys {

/** \brief Storage device action
  * \see StorageEvent
  */
enum class StorageAction {
    Add,     ///< Device is connected to the system
    Remove,  ///< Device is disconnected from the system
    Change,  ///< Something about the device changed
    Move,    ///< Device node was moved, renamed, or re-parented
    Present  ///< Device has been present when the StorageMonitor was started
};

string str(StorageAction action);

/** \brief Notification send by the StorageMonitor
  */
class StorageEvent: public Object
{
    friend class Object;

public:
    StorageAction action() const { return action_; }

    string sysPath  () const { return sysPath_;   }
    string devNode  () const { return devNode_;   }
    string serial   () const { return serial_;    }
    string fsType   () const { return fsType_;    }
    string fsVersion() const { return fsVersion_; }
    string fsLabel  () const { return fsLabel_;   }

    bool isUsbStorage() const { return isUsbStorage_; }

    string vendor  () const { return vendor_;   }
    string model   () const { return model_;    }
    string vendorId() const { return vendorId_; }
    string modelId () const { return modelId_;  }

    string toString() const;

private:
    StorageEvent(struct udev_device *dev);

    StorageAction action_ { StorageAction::Present };

    string sysPath_;
    string devNode_;
    string serial_;
    string fsType_;
    string fsVersion_;
    string fsLabel_;

    bool isUsbStorage_;
    string vendor_;
    string model_;
    string vendorId_;
    string modelId_;
};

}} // namespace cc::sys
