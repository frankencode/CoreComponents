/*
 * Copyright (C) 2017 Frank Mertens.
 *
 * Distribution and use is allowed under the terms of the zlib license
 * (see cc/LICENSE-zlib).
 *
 */

#pragma once

#include <cc/ui/Window>
#include <cc/ui/Cursor>
#include <cc/ui/TextInputFocus>

namespace cc { template<class> class Set; }

namespace cc {
namespace ui {

class Timer;
class PointerEvent;
class FingerEvent;

class Application: public Object
{
public:
    static Application *open(int argc, char **argv);
    static Application *instance();

    Property<bool> cursorVisible { true };
    Property<bool> screenSaverEnabled { false };

    Property<double> textZoom { 1 };

    Property< Ref<const TextInputFocus> > textInputFocus;

    Property< Ref<View> > hoveredView;

    virtual Window *openWindow(View *view, String title = String{}, WindowMode mode = WindowMode::Default) = 0;

    virtual Ref<Cursor> createCursor(CursorShape shape) = 0;
    virtual const Cursor *cursor() const = 0;
    virtual void setCursor(const Cursor *cursor) = 0;
    virtual void unsetCursor() = 0;

    virtual String getClipboardText() const = 0;
    virtual void setClipboardText(String text) = 0;

    TextSmoothing textSmoothing() const;
    void setTextSmoothing(TextSmoothing newValue) { textSmoothing_ = newValue; }

    virtual int run() = 0;

protected:
    friend class Window;
    friend class TextInputFocus;

    Application();
    ~Application();

    virtual void init(int argc, char **argv) = 0;

    virtual void startTextInput(const Window *window, const Rect &inputArea) = 0;
    virtual void stopTextInput() = 0;

    void notifyTimer(Timer *t);

    void updateCursorOnPointerMoved(Window *window, const PointerEvent *event);

    bool feedFingerEvent(Window *window, FingerEvent *event);
    bool feedMouseEvent(Window *window, MouseEvent *event);
    bool feedWheelEvent(Window *window, WheelEvent *event);
    bool feedKeyEvent(Window *window, KeyEvent *event);
    bool feedTextEditingEvent(const String &text, int start, int length);
    bool feedTextInputEvent(const String &text);

    TextSmoothing textSmoothing_ { TextSmoothing::Default };
};

}} // namespace cc::ui
