/*
 * Copyright (C) 2018 Frank Mertens.
 *
 * Distribution and use is allowed under the terms of the zlib license
 * (see cc/LICENSE-zlib).
 *
 */

#pragma once

#include <cc/ui/ScaledFont>

namespace cc {
namespace ui {

/** Text styling
  */
class Font
{
public:
    class Instance {
    public:
        String family() const { return family_; }
        void setFamily(const String &newValue) { family_ = newValue; }

        double size() const { return size_; }
        void setSize(double newValue) { size_ = newValue; }

        Slant slant() const { return slant_; }
        void setSlant(Slant newValue) { slant_ = newValue; }

        Weight weight() const { return weight_; }
        void setWeight(Weight newValue) { weight_ = newValue; }

        Stretch stretch() const { return stretch_; }
        void setStretch(Stretch newValue) { stretch_ = newValue; }

        Decoration decoration() const { return decoration_; }
        void setDecoration(Decoration newValue) { decoration_ = newValue; }

        Color color() const { return color_; }
        void setColor(Color newValue) { color_ = newValue; }

        const ScaledFont *getScaledFont() const;
        const FontMetrics *getMetrics() const;

    private:
        friend class Font;
        friend class FontManager;

        Instance(): size_{-1} {}
        Instance(double size): size_{size} {}
        Instance(String family, double size): family_{family}, size_{size} {}

        String family_;
        double size_;
        Slant slant_ { Slant::Normal };
        Weight weight_ { Weight::Normal };
        Stretch stretch_ { Stretch::Normal };
        Decoration decoration_ { Decoration::None };
        Color color_;

        mutable Ref<const ScaledFont> scaledFont_;
    };

    Font(double size = -1): instance_{size} {}
    Font(String family, double size = -1): instance_{family, size} {}

    Font &operator<<(Slant slant) {
        (*this)->setSlant(slant);
        return *this;
    }

    Font &operator<<(Weight weight) {
        (*this)->setWeight(weight);
        return *this;
    }

    Font &operator<<(Stretch stretch) {
        (*this)->setStretch(stretch);
        return *this;
    }

    Font &operator<<(Decoration decoration) {
        (*this)->setDecoration(decoration);
        return *this;
    }

    Font &operator<<(Pitch pitch);

    Font &operator<<(Color color) {
        (*this)->setColor(color);
        return *this;
    }

    Font &operator*=(double scale);

    static String defaultFamily();
    static double defaultSize();

    const Instance *operator->() const { return &instance_; }
    Instance *operator->() { return &instance_; }

    bool operator==(const Font &b) const { return !differ(*this, b); }
    bool operator!=(const Font &b) const { return differ(*this, b); }

private:
    friend class Instance;

    static bool differ(const Font &a, const Font &b);

    Instance instance_;
};

inline Font operator*(const Font &font, double scale) { Font f = font; return f *= scale; }
inline Font operator*(double scale, const Font &font) { return font * scale; }

}} // namespace cc::ui
