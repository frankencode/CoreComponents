/*
 * Copyright (C) 2007-2017 Frank Mertens.
 *
 * Distribution and use is allowed under the terms of the zlib license
 * (see cc/LICENSE-zlib).
 *
 */

#pragma once

#include <errno.h>
#include <cc/Exception>

namespace cc {

/** \class UsageError cc/exceptions
  * \brief %User input ambiguous, report back to user and provide guidance
  */
class UsageError: public Exception
{
public:
    UsageError(const String &message = ""): message_(message) {}
    ~UsageError() throw() {}

    String message() const override { return message_; }

private:
    String message_;
};

/** \class HelpRequest cc/exceptions
  * \brief %User requested help
  */
class HelpRequest: public Exception
{
public:
    ~HelpRequest() throw() {}

    String message() const override { return "No help, yet ..."; }
};

typedef HelpRequest HelpError; // FIXME: obsolete

/** \class VersionError cc/exceptions
  * \brief %User requested the application version
  */
class VersionRequest: public Exception
{
public:
    ~VersionRequest() throw() {}

    String message() const override { return "Application is not versioned, yet ..."; }
};

/** \class EncodingError cc/exceptions
  * \brief Some encoded data is mailformed
  */
class EncodingError: public Exception
{
public:
    ~EncodingError() throw() {}
};

/** \class UnexpectedEndOfInputError cc/exceptions
  * \brief End of input reached although more data is needed
  */
class UnexpectedEndOfInputError: public Exception
{
public:
    ~UnexpectedEndOfInputError() throw() {}

    String message() const override { return "Unexpected end of input"; }
};

/** \class BufferOverflow cc/exceptions
  * \brief Some buffer size is exceeded
  */
class BufferOverflow: public Exception
{
public:
    ~BufferOverflow() throw() {}

    String message() const override { return "Buffer overflow"; }
};

/** \class DebugError cc/exceptions
  * \brief Debugging hint on internal system malfunction
  */
class DebugError: public Exception
{
public:
    DebugError(const String &reason, const char *source, int line):
        reason_(reason),
        source_(source),
        line_(line)
    {}
    ~DebugError() throw() {}

    String message() const override;

private:
    String reason_;
    const char *source_;
    int line_;
};

String systemError(int errorCode);

/** \class SystemError cc/exceptions
  * \brief %System call failed
  */
class SystemError: public Exception
{
public:
    SystemError(int errorCode): errorCode_(errorCode) {}
    ~SystemError() throw() {}

    int errorCode() const { return errorCode_; }

    String message() const override;

protected:
    int errorCode_;
};

/** \class SystemResourceError cc/exceptions
  * \brief %System call failed to perform an action on a named resource (e.g. a file)
  */
class SystemResourceError: public SystemError
{
public:
    SystemResourceError(int errorCode, const String &resource, const char *source, int line):
        SystemError(errorCode),
        resource_(resource),
        source_(source),
        line_(line)
    {}
    ~SystemResourceError() throw() {}

    String resource() const { return resource_; }
    const char *source() const { return source_; }
    int line() const { return line_; }

    String message() const override;

private:
    String resource_;
    const char *source_;
    int line_;
};

/** \class SystemDebugError cc/exceptions
  * \brief Debugging hint on system call failure
  */
class SystemDebugError: public SystemError
{
public:
    SystemDebugError(int errorCode, const char *source, int line):
        SystemError(errorCode),
        source_(source),
        line_(line)
    {}
    ~SystemDebugError() throw() {}

    const char *source() const { return source_; }
    int line() const { return line_; }

    String message() const override;

private:
    const char *source_;
    int line_;
};

#define CC_DEBUG_ERROR(reason) \
    throw DebugError(reason, __FILE__, __LINE__)

#define CC_SYSTEM_RESOURCE_ERROR(errorCode, resource) \
    throw SystemResourceError(errorCode, resource, __FILE__, __LINE__)

#define CC_SYSTEM_DEBUG_ERROR(errorCode) \
    throw SystemDebugError(errorCode, __FILE__, __LINE__)

#define CC_SYSTEM_ERROR(errorCode, resource) \
    { \
        if (resource != "") CC_SYSTEM_RESOURCE_ERROR(errorCode, resource); \
        else CC_SYSTEM_DEBUG_ERROR(errorCode); \
    }

/** \class TextError cc/exceptions
  * \brief General error related to a text (progam text, config file, etc.)
  */
class TextError: public Exception
{
public:
    String text() const { return text_; }
    int offset() const { return offset_; }
    String resource() const { return resource_; }

    void setResource(const String &resource) { resource_ = resource; }

protected:
    TextError(const String &text, int offset, const String &resource = "");
    ~TextError() throw() {}

    String text_;
    int offset_;
    String resource_;
};

/** \class SemanticError cc/exceptions
  * \brief Semantic error
  */
class SemanticError: public TextError
{
public:
    SemanticError(const String &reason, const String &text = "", int offset = -1, const String &resource = ""):
        TextError(text, offset, resource),
        reason_(reason)
    {}
    ~SemanticError() throw() {}

    String reason() const { return reason_; }

    String message() const override;

private:
    String reason_;
};

/** \class Timeout cc/exceptions
  * \brief Operation timed out
  */
class Timeout: public Exception
{
public:
    ~Timeout() throw() {}
    String message() const override;
};

/** \class ConnectionResetByPeer cc/exceptions
  * \brief Other end of a communication channel was closed (pipe or socket)
  */
class ConnectionResetByPeer: public Exception
{
public:
    ~ConnectionResetByPeer() throw() {}
    String message() const override;
};

/** \class TransferError cc/exceptions
  * \brief A data transfer operation failed
  * \see Transfer
  */
class TransferError: public Exception
{
public:
    TransferError(String details);
    ~TransferError() throw() {}

    virtual String message() const override;

private:
    String details_;
};

/** \class PermissionError cc/exceptions
  * \brief Insufficient permission to perform operation
  */
class PermissionError: public UsageError
{
public:
    ~PermissionError() throw() {}
    virtual String message() const override;
};

/** \class CommandNotFound cc/exceptions
  * \brief Command not found error
  */
class CommandNotFound: public UsageError
{
public:
    CommandNotFound(const String &command = ""):
        command_(command)
    {}
    ~CommandNotFound() throw() {}

    String command() const { return command_; }

    virtual String message() const override;

private:
    String command_;
};

} // namespace cc
